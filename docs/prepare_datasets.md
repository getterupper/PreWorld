## Prepare nuScenes Dataset

step 1: Download nuScenes V1.0 full dataset data from [HERE](https://www.nuscenes.org/download) on `./data/nuscenes`.

step 2: Download nuScenes-lidarseg data from [HERE](https://www.nuscenes.org/download).

step 3: Download (only) the 'gts' from [Occ3D-nuScenes](https://github.com/Tsinghua-MARS-Lab/Occ3D).

step 4: Create the pkl files:

```
python tools/create_data_bevdet.py
```

step 5: Create 2D GT for PreWorld:

```
python tools/gen_data/gen_depth_gt.py
python tools/gen_data/gen_seg_gt_from_lidarseg.py
```

step 6: Download pre-trained model weights:

```
mkdir ckpts
cd ckpts & wget https://github.com/pmj110119/storage/releases/download/v1/bevdet-stbase-4d-stereo-512x1408-cbgs.pth
```

## Prepare nuScenes 4D Occupancy Forecasting (Optional)

step 1: Download train/val pickle files generated by [OccWorld](https://github.com/wzzheng/OccWorld).

step 2: Download and arrange pickle files following [AD-MLP](https://github.com/E2E-AD/AD-MLP).

## Folder structure

```
PreWorld
├── mmdet3d/
├── tools/
├── configs/
├── ckpts/
│   ├── TODO.pth
├── data/
│   ├── nuscenes/
│   │   ├── gts/  # ln -s occupancy gts to this location
│   │   ├── maps/
│   │   ├── samples/
│   │   ├── sweeps/
|   |   ├── bevdetv2-nuscenes_infos_val.pkl    # generated by step 4
|   |   ├── bevdetv2-nuscenes_infos_train.pkl  # generated by step 4
|   |   ├── lidarseg
|   |   │   └── v1.0-{mini, test, trainval} <- Contains the .bin files; a .bin file 
|   |   │                                      contains the labels of the points in a 
|   |   │                                      point cloud
|   |   └── v1.0-{mini, test, trainval}
|   |       ├── Usual files (e.g. attribute.json, calibrated_sensor.json etc.)
|   |       ├── lidarseg.json  <- contains the mapping of each .bin file to the token
|   |       └── category.json  <- contains the categories of the labels (note that the 
|   |                         category.json from nuScenes v1.0 is overwritten)
│   ├── seg_gt_lidarseg       # generated by step 5
│   └── depth_gt              # generated by step 5
├── occworld/
│   ├── nuscenes_infos_train_temporal_v3_scene.pkl
│   └── nuscenes_infos_val_temporal_v3_scene.pkl
├── admlp/
│   ├── fengze_nuscenes_infos_val.pkl
│   ├── fengze_nuscenes_infos_train.pkl
│   └── stp3_val
│       ├── data_nuscene.pkl
│       ├── filter_token.pkl
│       ├── stp3_occupancy.pkl
│       └── stp3_traj_gt.pkl
│

```